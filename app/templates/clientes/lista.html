<!-- app/templates/clientes/lista.html -->
{% extends 'layout/base.html' %}
{% from 'layout/components.html' import action_buttons, confirmation_modal %}

{% block title %}AM3.1 - Clientes{% endblock %}

{% block page_title %}Gestión de Clientes{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col">
        <a href="{{ url_for('clientes.nuevo_cliente') }}" class="btn btn-primary">
            <i class="fas fa-plus"></i> Nuevo Cliente
        </a>
    </div>
    <div class="col-md-4">
        <div class="input-group">
            <input type="text" class="form-control table-filter" placeholder="Buscar cliente..." data-table="clientes-table">
            <button class="btn btn-outline-secondary" type="button" onclick="exportTableToCSV('clientes-table', 'clientes.csv')">
                <i class="fas fa-download"></i> Exportar
            </button>
        </div>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-striped table-hover" id="clientes-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nombre</th>
                        <th>CIF/NIF</th>
                        <th>Dirección</th>
                        <th>Teléfono</th>
                        <th>Email</th>
                        <th>Tipo</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for cliente in clientes %}
                    <tr>
                        <td>{{ cliente.id }}</td>
                        <td>{{ cliente.nombre }}</td>
                        <td>{{ cliente.cif_nif }}</td>
                        <td>
                            {% if cliente.tipo_via and cliente.nombre_via %}
                                {{ cliente.tipo_via }} {{ cliente.nombre_via }}
                                {% if cliente.numero_via %} {{ cliente.numero_via }}{% endif %}
                                {% if cliente.puerta %} {{ cliente.puerta }}{% endif %}
                                {% if cliente.codigo_postal or cliente.poblacion %},
                                    {{ cliente.codigo_postal }} {{ cliente.poblacion }}
                                {% endif %}
                            {% endif %}
                        </td>
                        <td>{{ cliente.telefono1 }}</td>
                        <td>{{ cliente.mail1 }}</td>
                        <td>{{ cliente.tipo_cliente }}</td>
                        <td>
                            {{ action_buttons(
                                edit_url=url_for('clientes.editar_cliente', id=cliente.id),
                                delete_url=url_for('clientes.eliminar_cliente', id=cliente.id),
                                confirm_id='delete-modal-' + cliente.id|string,
                                custom_buttons=[
                                    {
                                        'url': url_for('proyectos.proyectos_por_cliente', id_cliente=cliente.id),
                                        'class': 'btn-info',
                                        'icon': 'fas fa-list',
                                        'title': 'Ver proyectos'
                                    },
                                    {
                                        'url': url_for('proyectos.nuevo_proyecto') + '?id_cliente=' + cliente.id|string,
                                        'class': 'btn-success',
                                        'icon': 'fas fa-plus',
                                        'title': 'Crear proyecto'
                                    }
                                ]
                            ) }}
                            
                            {{ confirmation_modal(
                                id='delete-modal-' + cliente.id|string,
                                title='Confirmar eliminación',
                                message='¿Está seguro de que desea eliminar el cliente "' + cliente.nombre + '"? Esta acción no se puede deshacer.',
                                action_url=url_for('clientes.eliminar_cliente', id=cliente.id)
                            ) }}
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="8" class="text-center">No hay clientes registrados</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}